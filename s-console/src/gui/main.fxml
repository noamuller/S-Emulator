<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.control.cell.*?>
<?import java.net.URL?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="gui.MainController">
    <top>
        <ToolBar>
            <Button text="Load XML" onAction="#onLoadXml"/>
            <Separator/>
            <Label text="Function:"/>
            <ComboBox fx:id="functionCombo" promptText="(all)" onAction="#onFunctionChanged" prefWidth="160"/>
            <Separator/>
            <Label text="Degree:"/>
            <TextField fx:id="degreeField" prefWidth="50"/>
            <Label text="/"/>
            <TextField fx:id="maxDegreeField" prefWidth="50" editable="false"/>
            <Button text="Show Program" onAction="#onShowProgram"/>
            <Separator/>
            <ProgressBar fx:id="loadProgress" prefWidth="150"/>
            <Label fx:id="loadStatus" text=""/>
        </ToolBar>
    </top>

    <center>
        <SplitPane dividerPositions="0.55">
            <!-- LEFT: Instructions table -->
            <VBox spacing="8" VBox.vgrow="ALWAYS">
                <TableView fx:id="instructionsTable" VBox.vgrow="ALWAYS"/>
                <!-- Filters -->
                <TitledPane text="Filters" expanded="false">
                    <content>
                        <GridPane hgap="8" vgap="6">
                            <padding><Insets topRightBottomLeft="10"/></padding>
                            <columnConstraints>
                                <ColumnConstraints halignment="RIGHT" minWidth="80"/>
                                <ColumnConstraints hgrow="ALWAYS"/>
                                <ColumnConstraints minWidth="100"/>
                            </columnConstraints>
                            <rowConstraints>
                                <RowConstraints vgrow="NEVER"/>
                                <RowConstraints vgrow="NEVER"/>
                            </rowConstraints>

                            <Label text="Label:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <TextField fx:id="labelFilterField" promptText="e.g. L7"
                                       GridPane.rowIndex="0" GridPane.columnIndex="1"/>
                            <Button text="Apply" onAction="#onApplyLabelFilter"
                                    GridPane.rowIndex="0" GridPane.columnIndex="2"/>

                            <Label text="Variable:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <TextField fx:id="varFilterField" promptText="e.g. x2 / y / z3"
                                       GridPane.rowIndex="1" GridPane.columnIndex="1"/>
                            <Button text="Apply" onAction="#onApplyVarFilter"
                                    GridPane.rowIndex="1" GridPane.columnIndex="2"/>
                        </GridPane>
                    </content>
                </TitledPane>
            </VBox>

            <!-- RIGHT: stacked panes wrapped in ScrollPane (resizes nicely) -->
            <ScrollPane fitToWidth="true" fitToHeight="true" pannable="false">
                <content>
                    <VBox spacing="10" fillWidth="true">
                        <padding><Insets topRightBottomLeft="8"/></padding>

                        <!-- Debugger -->
                        <TitledPane text="Debugger" expanded="true">
                            <content>
                                <VBox spacing="8">
                                    <padding><Insets topRightBottomLeft="10"/></padding>
                                    <GridPane hgap="12" vgap="6">
                                        <columnConstraints>
                                            <ColumnConstraints minWidth="60"/>
                                            <ColumnConstraints minWidth="60"/>
                                            <ColumnConstraints minWidth="80"/>
                                            <ColumnConstraints hgrow="ALWAYS"/>
                                        </columnConstraints>
                                        <rowConstraints>
                                            <RowConstraints vgrow="NEVER"/>
                                            <RowConstraints vgrow="NEVER"/>
                                            <RowConstraints vgrow="NEVER"/>
                                        </rowConstraints>

                                        <Label text="PC:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                                        <Label fx:id="pcLabel" text="*" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                                        <Label text="Cycles:" GridPane.rowIndex="0" GridPane.columnIndex="2"/>
                                        <Label fx:id="cyclesLabel" text="0" GridPane.rowIndex="0" GridPane.columnIndex="3"/>

                                        <Label text="Halted:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                                        <Label fx:id="haltLabel" text="false" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                                        <HBox spacing="8" GridPane.rowIndex="2" GridPane.columnIndex="0" GridPane.columnSpan="4">
                                            <Button text="Start Debug" onAction="#onStartDebug"/>
                                            <Button text="Resume" onAction="#onResume"/>
                                            <Button text="Step" onAction="#onStepOver"/>
                                            <Button text="Stop" onAction="#onStop"/>
                                            <Pane HBox.hgrow="ALWAYS"/>
                                        </HBox>
                                    </GridPane>

                                    <TextArea fx:id="debugSummaryArea" prefRowCount="8" wrapText="true" VBox.vgrow="ALWAYS"/>
                                </VBox>
                            </content>
                        </TitledPane>

                        <!-- Run -->
                        <TitledPane text="Run" expanded="true">
                            <content>
                                <VBox spacing="8">
                                    <padding><Insets topRightBottomLeft="10"/></padding>
                                    <HBox spacing="8">
                                        <Label text="Inputs:"/>
                                        <Spinner fx:id="addInputSpinner" editable="true" prefWidth="90"/>
                                        <Button text="Add" onAction="#onAddInput"/>
                                        <Button text="Remove selected" onAction="#onRemoveSelectedInput"/>
                                        <Button text="Clear" onAction="#onClearInputs"/>
                                        <Pane HBox.hgrow="ALWAYS"/>
                                        <Button text="Run" onAction="#onRun"/>
                                    </HBox>
                                    <ListView fx:id="inputsList" prefHeight="100"/>
                                    <!-- Fallback text field; controller prefers ListView if not empty -->
                                    <TextField fx:id="inputsField" promptText="fallback: e.g. 4, 1, 0, 7"/>
                                    <TextArea fx:id="runSummaryArea" prefRowCount="8" wrapText="true" VBox.vgrow="ALWAYS"/>
                                </VBox>
                            </content>
                        </TitledPane>

                        <!-- History -->
                        <TitledPane text="History" expanded="true">
                            <content>
                                <VBox spacing="8">
                                    <padding><Insets topRightBottomLeft="10"/></padding>
                                    <TableView fx:id="historyTable" prefHeight="200" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn text="#" prefWidth="50">
                                                <cellValueFactory><PropertyValueFactory property="runNo"/></cellValueFactory>
                                            </TableColumn>
                                            <TableColumn text="Degree" prefWidth="70">
                                                <cellValueFactory><PropertyValueFactory property="degree"/></cellValueFactory>
                                            </TableColumn>
                                            <TableColumn text="Inputs" prefWidth="160">
                                                <cellValueFactory><PropertyValueFactory property="inputsCsv"/></cellValueFactory>
                                            </TableColumn>
                                            <TableColumn text="y" prefWidth="70">
                                                <cellValueFactory><PropertyValueFactory property="y"/></cellValueFactory>
                                            </TableColumn>
                                            <TableColumn text="Cycles" prefWidth="80">
                                                <cellValueFactory><PropertyValueFactory property="cycles"/></cellValueFactory>
                                            </TableColumn>
                                        </columns>
                                    </TableView>
                                    <HBox spacing="8">
                                        <Button text="Re-run selected" onAction="#onRerunSelected"/>
                                        <Pane HBox.hgrow="ALWAYS"/>
                                    </HBox>
                                </VBox>
                            </content>
                        </TitledPane>

                    </VBox>
                </content>
            </ScrollPane>
        </SplitPane>
    </center>

    <stylesheets>
        <URL value="@style.css"/>
    </stylesheets>


</BorderPane>
